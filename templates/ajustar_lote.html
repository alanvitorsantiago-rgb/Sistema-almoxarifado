{% extends 'base.html' %}

{% block title %}Ajustar Lote{% endblock %}

{% block content %}
<h3>Ajuste de Lote para o Item: <span class="text-primary">{{ detalhe.item_estoque.descricao }}</span></h3>
<p class="text-muted">Ajustando o Lote: <strong>{{ detalhe.lote }}</strong> | Item NF: <strong>{{ detalhe.item_nf }}</strong></p>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{ url_for('ajustar_lote', detalhe_id=detalhe.id) }}">
            <div class="row g-3">
                <!-- Campo de Quantidade -->
                <div class="col-md-4">
                    <label for="quantidade" class="form-label">Nova Quantidade (Saldo)</label>
                    <input type="number" step="any" class="form-control" id="quantidade" name="quantidade" value="{{ detalhe.quantidade }}" required>
                    <div class="form-text">
                        A quantidade atual é <strong>{{ detalhe.quantidade }}</strong>. Alterar este valor irá gerar um registro de ajuste no histórico.
                    </div>
                </div>

                <!-- Campo de Lote -->
                <div class="col-md-4">
                    <label for="lote" class="form-label">Lote</label>
                    <input type="text" class="form-control" id="lote" name="lote" value="{{ detalhe.lote or '' }}">
                </div>

                <!-- Campo NF -->
                <div class="col-md-4">
                    <label for="nf" class="form-label">Nota Fiscal (NF)</label>
                    <input type="text" class="form-control" id="nf" name="nf" value="{{ detalhe.nf or '' }}">
                </div>

                <!-- Campo Item NF -->
                <div class="col-md-4">
                    <label for="item_nf" class="form-label">Item da Nota Fiscal</label>
                    <input type="text" class="form-control" id="item_nf" name="item_nf" value="{{ detalhe.item_nf or '' }}">
                </div>

                <!-- Campo Validade -->
                <div class="col-md-4">
                    <label for="validade" class="form-label">Data de Validade</label>
                    <input type="date" class="form-control" id="validade" name="validade" value="{{ detalhe.validade.strftime('%Y-%m-%d') if detalhe.validade else '' }}">
                </div>

                <!-- Campo Endereço -->
                <div class="col-md-8">
                    <label for="endereco" class="form-label">Endereço do Item</label>
                    <input type="text" class="form-control" id="endereco" name="endereco" value="{{ detalhe.item_estoque.endereco or '' }}">
                </div>

                <!-- Campo Estação -->
                <div class="col-md-12">
                    <label for="estacao" class="form-label">Estação</label>
                    <input type="text" class="form-control" id="estacao" name="estacao" value="{{ detalhe.estacao or '' }}">
                </div>

                <!-- Campo Observação -->
                <div class="col-12">
                    <label for="observacao" class="form-label">Motivo do Ajuste (Obrigatório)</label>
                    <textarea class="form-control" id="observacao" name="observacao" rows="3" placeholder="Ex: Correção de contagem de inventário, ajuste de dados da NF, etc." required></textarea>
                </div>

            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Ajuste</button>
                <a href="{{ url_for('detalhes_lotes', item_id=detalhe.item_estoque.id) }}" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}